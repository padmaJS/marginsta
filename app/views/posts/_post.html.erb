<div class="card shadow-sm rounded-4 border-0 mb-4">
  <div class="card-body p-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <div class="mb-2">
        <span class="fw-bold text-primary" style="font-size: 1.1rem;"><%= post.user.user_name %></span>
      </div>
      <% if action == :show%>
        <div>
          <% if post.user == current_user %>
            <%= link_to "Edit", edit_post_path(post), class: "btn btn-link btn-sm text-decoration-none" %>
          <% end %>
          <%= link_to "Back", root_path, class: "btn btn-link btn-sm text-decoration-none" %>
        </div>
      <% end %>
    </div>
    <div class="mb-2">
      <span class="text-secondary" style="font-size: 1.05rem;"><%= post.caption %></span>
    </div>
    <% if post.image.attached? %>
      <div class="text-center">
        <% link = action == :index ? post_path(post) : "#" %>
        <%= link_to link do %>
          <%= image_tag post.image.variant(resize_to_limit: [1080,566]), class: "card-img-top rounded-3 border", alt: "Post image" %>
        <% end %>
      </div>
    <% end %>
    <% if action == :show %>
      <div class="mt-4">
        <h6 class="fw-bold mb-3">Comments</h6>
        <% if user_signed_in? %>
          <%= form_with(model: [post, Comment.new], local: true) do |form| %>
            <div class="input-group mb-3">
              <%= form.text_area :content, rows: 1, class: "form-control", placeholder: "Add a comment..." %>
              <button class="btn btn-primary" type="submit">Post</button>
            </div>
          <% end %>
        <% end %>
        <div class="mt-3">
          <% post.comments.order(created_at: :desc).each do |comment| %>
            <div class="border rounded-3 p-3 mt-2 bg-light">
              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-bold text-primary"><%= comment.user.user_name %></span>
                <div>
                  <span class="text-muted small"><%= time_ago_in_words(comment.created_at) %> ago</span>
                  <% if comment.user == current_user %>
                    <div class="btn-group">
                      <button type="button" class="btn" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-three-dots-vertical"></i>
                      </button>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Edit</a></li>
                        <li><%= link_to "Delete", [post, comment], data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "text-danger dropdown-item" %></li>
                      </ul>
                    </div>
                  <% end%>
                </div>
              </div>
              <div class="mt-1"><%= comment.content %></div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>